@{
    ViewBag.Title = "Home Page";
}

<div class="col-sm-6 films">

</div>

<div class="row">
    <form role="search" class="navbar-form" id="search">
        <div class="col-sm-6 films">
            <input class="typeahead form-control" name="films" type="text" autocomplete="off" value="" />
        </div>
        <button class="btn btn-default" type="submit">Search</button>
    </form>
</div>
<div class="row">
    <table id="resultsProject" class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Project</th>
                <th>Name</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<div class="row">
    <table id="resultsEmployee" class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Employee</th>
                <th>Name</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>



<script type="text/javascript">
   

    var names = new Bloodhound({
        datumTokenizer: function (d) { return Bloodhound.tokenizers.whitespace(d.name); },
        queryTokenizer: Bloodhound.tokenizers.whitespace,
        prefetch: {
            url: '/searchcontroller?q=ny',
            ttl: 0 //Amount of time the data is cached (1 day)
        }
    });
    // initialize the bloodhound suggestion engine
    names.initialize();
    console.log(names);

    // instantiate the typeahead UI
    $('.films .typeahead').typeahead(null, {
        displayKey: 'name',
        source: names.ttAdapter()
    });


    

    $(function () {
        function search() {
            var query = $("#search").find("input[name=search]").val();

            $.get("/searchcontroller?q=" + encodeURIComponent(query),
                    function (data) {
                        var p = $("table#resultsProject tbody").empty();
                        var e = $("table#resultsEmployee tbody").empty();
                        if (!data || data.length == 0) return;
                        data.forEach(function (row) {
                            
                            var movie = row.movie;
                            if (row.label == "Project") {
                                $("<tr><td class='movie'>" + row.name + "</td><td>" + row.label + "</td><td>").appendTo(p)
                                        .click(function () { showMovie($(this).find("td.movie").text()); })
                            }
                            if (row.label == "Employee") {
                                $("<tr><td class='movie'>" + row.name + "</td><td>" + row.label + "</td><td>").appendTo(e)
                                        .click(function () { showMovie($(this).find("td.movie").text()); })
                            }
                        });
                        
                    }, "json");
            return false;
        }

        $("#search").submit(search);
        search();
    })
</script>